<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Realtime Chat</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 0; background: #e5ddd5; }
    .chat-container { max-width: 600px; margin: auto; height: 100vh; display: flex; flex-direction: column; }
    header { background: #075E54; color: white; padding: 10px; display: flex; justify-content: space-between; align-items: center; }
    header h1 { font-size: 16px; margin: 0; }
    #status { font-size: 12px; opacity: 0.8; }
    #messages { flex: 1; overflow-y: auto; padding: 10px; display: flex; flex-direction: column; gap: 8px; }
    .bubble { max-width: 75%; padding: 8px 12px; border-radius: 8px; position: relative; font-size: 14px; }
    .me { align-self: flex-end; background: #DCF8C6; }
    .other { align-self: flex-start; background: white; }
    .time { font-size: 10px; color: #777; text-align: right; margin-top: 4px; }
    .composer { display: flex; padding: 10px; background: white; }
    .composer input { flex: 1; padding: 8px; border: 1px solid #ccc; border-radius: 20px; outline: none; }
    .composer button { margin-left: 8px; padding: 8px 14px; border: none; border-radius: 20px; background: #25D366; color: white; font-weight: bold; }
  </style>
</head>
<body>
  <div class="chat-container">
    <header>
      <div>
        <h1>Realtime Chat</h1>
        <div id="status">Online</div>
      </div>
      <div id="meName"></div>
    </header>

    <div id="messages"></div>

    <div class="composer">
      <input id="messageInput" placeholder="Type a message..." />
      <button id="sendBtn">Send</button>
    </div>
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-app.js";
    import { getDatabase, ref, push, query, orderByChild, onChildAdded, serverTimestamp } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-database.js";

    // === Your Firebase Config ===
    const firebaseConfig = {
      apiKey: "YOUR_API_KEY",
      authDomain: "YOUR_PROJECT_ID.firebaseapp.com",
      databaseURL: "https://YOUR_PROJECT_ID-default-rtdb.firebaseio.com",
      projectId: "YOUR_PROJECT_ID",
      storageBucket: "YOUR_PROJECT_ID.appspot.com",
      messagingSenderId: "YOUR_SENDER_ID",
      appId: "YOUR_APP_ID"
    };
    // ============================

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);
    const messagesRef = ref(db, "messages");

    // Get username
    let name = localStorage.getItem("chat_name");
    if (!name) {
      name = prompt("Enter your name:") || "Guest" + Math.floor(Math.random() * 1000);
      localStorage.setItem("chat_name", name);
    }
    document.getElementById("meName").textContent = name;

    // Elements
    const messagesDiv = document.getElementById("messages");
    const input = document.getElementById("messageInput");
    const sendBtn = document.getElementById("sendBtn");

    sendBtn.addEventListener("click", sendMessage);
    input.addEventListener("keyup", (e) => {
      if (e.key === "Enter") sendMessage();
    });

    function sendMessage() {
      const text = input.value.trim();
      if (!text) return;
      push(messagesRef, { name, text, ts: Date.now() });
      input.value = "";
    }

    const q = query(messagesRef, orderByChild("ts"));
    onChildAdded(q, (snap) => {
      const msg = snap.val();
      addMessage(msg);
    });

    function addMessage(msg) {
      const div = document.createElement("div");
      div.classList.add("bubble");
      div.classList.add(msg.name === name ? "me" : "other");

      const time = new Date(msg.ts).toLocaleTimeString([], { hour: "2-digit", minute: "2-digit" });

      div.innerHTML = `<div><strong>${escapeHTML(msg.name)}</strong></div>
                       <div>${escapeHTML(msg.text)}</div>
                       <div class="time">${time}</div>`;
      messagesDiv.appendChild(div);
      messagesDiv.scrollTop = messagesDiv.scrollHeight;
    }

    function escapeHTML(s) {
      return String(s).replace(/[&<>'"]/g, (c) => ({
        '&': '&amp;', '<': '&lt;', '>': '&gt;', "'": '&#39;', '"': '&quot;'
      }[c]));
    }
  </script>
</body>
</html>  const app = initializeApp(firebaseConfig);
  const db = getDatabase(app);

  const messagesDiv = document.getElementById("messages");
  const messageInput = document.getElementById("messageInput");
  const sendBtn = document.getElementById("sendBtn");

  // Send message
  sendBtn.addEventListener("click", () => {
    const text = messageInput.value;
    if (text.trim() !== "") {
      push(ref(db, "messages"), { text: text });
      messageInput.value = "";
    }
  });

  // Listen for messages
  onChildAdded(ref(db, "messages"), (snapshot) => {
    const msg = snapshot.val();
    const p = document.createElement("p");
    p.textContent = msg.text;
    messagesDiv.appendChild(p);
    messagesDiv.scrollTop = messagesDiv.scrollHeight;
  });
</script>

</body>
</html>  const app = initializeApp(firebaseConfig);
  const db = getDatabase(app);

  const messagesDiv = document.getElementById("messages");
  const messageInput = document.getElementById("messageInput");
  const sendBtn = document.getElementById("sendBtn");

  // Send message
  sendBtn.addEventListener("click", () => {
    const text = messageInput.value;
    if (text.trim() !== "") {
      push(ref(db, "messages"), { text: text });
      messageInput.value = "";
    }
  });

  // Listen for messages
  onChildAdded(ref(db, "messages"), (snapshot) => {
    const msg = snapshot.val();
    const p = document.createElement("p");
    p.textContent = msg.text;
    messagesDiv.appendChild(p);
    messagesDiv.scrollTop = messagesDiv.scrollHeight;
  });
</script>

</body>
</html>
